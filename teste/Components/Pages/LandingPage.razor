@page "/"
@layout Layout.EmptyLayout
@using Microsoft.EntityFrameworkCore
@using teste.Models
@using teste.Data
@using teste.Services
@inject IDbContextFactory<ApplicationDbContext> DbFactory
@inject HorarioService HorarioService
@inject IJSRuntime JS

<PageTitle>Barbearia - Agende seu Hor√°rio</PageTitle>

@rendermode InteractiveServer

<div class="landing-layout">
    <div class="landing-page">
        <header class="hero-section">
            <div class="container">
                <div class="row align-items-center min-vh-100">
                    <div class="col-lg-6">
                        <h1 class="display-4 fw-bold text-light mb-4">
                            ‚úÇÔ∏è Barbearia Profissional
                        </h1>
                        <p class="lead text-light mb-4">
                            Agende seu hor√°rio de forma r√°pida e f√°cil.
                            Cortes modernos, barbas bem feitas e atendimento de qualidade.
                        </p>
                        <div class="d-flex gap-3">
                            <button class="btn btn-primary btn-lg" @onclick="ScrollToAgendamento">
                                <i class="fas fa-calendar-plus me-2"></i>Agendar Hor√°rio
                            </button>

                            <button class="btn btn-outline-light btn-lg" @onclick="ScrollToServicos">
                                <i class="fas fa-scissors me-2"></i>Ver Servi√ßos
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Servi√ßos -->
        <section id="servicos" class="py-5">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center mb-5">
                        <h2 class="display-5 text-light">Nossos Servi√ßos</h2>
                        <p class="lead text-muted">Qualidade e profissionalismo em cada corte</p>
                    </div>
                </div>

                @if (Servicos != null && Servicos.Any())
                {
                    <div class="row">
                        @foreach (var servico in Servicos)
                        {
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card service-card h-100">
                                    <div class="card-body text-center">
                                        <div class="service-icon mb-3">
                                            <i class="fas fa-cut fa-3x text-primary"></i>
                                        </div>
                                        <h5 class="card-title">@servico.Nome</h5>
                                        <p class="card-text text-muted">@servico.Descricao</p>
                                        <div class="service-details">
                                            <span class="badge bg-info me-2">@servico.DuracaoEmMinutos min</span>
                                            <span class="badge bg-success">R$ @servico.Preco.ToString("F2")</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="row">
                        <div class="col-12 text-center">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle fa-2x mb-3"></i>
                                <h5>Servi√ßos em breve</h5>
                                <p>Nossos servi√ßos estar√£o dispon√≠veis em breve.</p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </section>

        <!-- Agendamento -->
        <section id="agendamento" class="py-5 bg-dark">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center mb-5">
                        <h2 class="display-5 text-light">Agende seu Hor√°rio</h2>
                        <p class="lead text-muted">Escolha o servi√ßo e hor√°rio que melhor te atende</p>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card booking-card">
                            <div class="card-header">
                                <h5 class="mb-0">üìÖ Selecionar Hor√°rio</h5>
                            </div>
                            <div class="card-body">
                                <CalendarioHorarios Servicos="Servicos"
                                                    HorarioSelecionado="HorarioSelecionado"
                                                    HorarioSelecionadoChanged="OnHorarioSelecionado" />
                            </div>
                        </div>

                        @if (HorarioSelecionado.HasValue)
                        {
                            <div class="card mt-4 booking-card">
                                <div class="card-header">
                                    <h5 class="mb-0">üë§ Dados do Cliente</h5>
                                </div>
                                <div class="card-body">
                                    <EditForm Model="Agendamento" OnValidSubmit="AddAgendamento">
                                        <DataAnnotationsValidator />
                                        <ValidationSummary class="text-danger" role="alert" />

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="nomeDoCliente" class="form-label">Nome Completo:</label>
                                                    <InputText id="nomeDoCliente" @bind-Value="Agendamento.NomeDoCliente" class="form-control" required />
                                                    <ValidationMessage For="() => Agendamento.NomeDoCliente" class="text-danger" />
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="numeroDoCliente" class="form-label">Telefone:</label>
                                                    <input type="text" id="numeroDoCliente" class="form-control"
                                                           value="@Agendamento.NumeroDoCliente"
                                                           @onchange="OnNumeroDoClienteInput"
                                                           maxlength="15" required
                                                           placeholder="(11) 99999-9999" />
                                                    <ValidationMessage For="() => Agendamento.NumeroDoCliente" class="text-danger" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="observacoes" class="form-label">Observa√ß√µes:</label>
                                            <InputTextArea id="observacoes" @bind-Value="Agendamento.Observacoes" class="form-control" rows="3" />
                                            <ValidationMessage For="() => Agendamento.Observacoes" class="text-danger" />
                                        </div>

                                        <div class="alert alert-success">
                                            <strong>Agendamento para:</strong> @HorarioSelecionado.Value.ToString("dd/MM/yyyy HH:mm")
                                        </div>

                                        @if (isLoading)
                                        {
                                            <div class="d-flex align-items-center">
                                                <div class="spinner-border spinner-border-sm me-2" role="status">
                                                    <span class="visually-hidden">Carregando...</span>
                                                </div>
                                                <span>Processando agendamento...</span>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-success btn-lg" disabled="@isLoading">
                                                    <i class="fas fa-check me-2"></i>Confirmar Agendamento
                                                </button>
                                                <button type="button" class="btn btn-secondary btn-lg" @onclick="LimparFormulario" disabled="@isLoading">
                                                    <i class="fas fa-times me-2"></i>Cancelar
                                                </button>
                                            </div>
                                        }
                                    </EditForm>
                                </div>
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(mensagemFeedback))
                        {
                            <div class="alert @(tipoMensagem == "success" ? "alert-success" : "alert-danger") mt-4" role="alert">
                                <i class="fas @(tipoMensagem == "success" ? "fa-check-circle" : "fa-exclamation-circle") me-2"></i>
                                @mensagemFeedback
                            </div>
                        }
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-5 bg-dark">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="text-light">Barbearia</h5>
                        <p class="text-muted">Qualidade e profissionalismo em cada corte.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <h5 class="text-light">Contato</h5>
                        <p class="text-muted">
                            <i class="fas fa-phone me-2"></i>(11) 99999-9999<br />
                            <i class="fas fa-map-marker-alt me-2"></i>Rua das Barbearias, 123<br />
                            <i class="fas fa-clock me-2"></i>Seg-S√°b: 08:00 - 18:00
                        </p>
                    </div>
                </div>
                <hr class="my-4">
                <div class="row">
                    <div class="col-12 text-center">
                        <p class="text-muted mb-0">
                            ¬© 2024 Barbearia. Todos os direitos reservados.
                            <a href="/admin" class="text-muted ms-3">√Årea Administrativa</a>
                        </p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>

